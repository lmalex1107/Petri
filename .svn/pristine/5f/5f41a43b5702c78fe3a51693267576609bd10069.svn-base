package view;

import java.util.ArrayList;

import org.graphstream.graph.implementations.MultiGraph;
import org.graphstream.graph.Edge;
import org.graphstream.graph.Node;

import model.Arc;
import model.ERArc;
import model.ERKnot;
import model.Knot;

public class Erreichbarkeitsgraph extends MultiGraph{
	
	private static String CSS_FILE = "url(" + PetriGraph.class.getResource("/graph.css") + ")";
	
	ArrayList<ERKnot>erknotlist = null;
	ArrayList<ERArc>erarclist = null;

	public Erreichbarkeitsgraph() {
		super("");
		this.addAttribute("ui.stylesheet", CSS_FILE);
	}
	
	public void addKnot (ArrayList<ERKnot> erknotlist, ArrayList<ERArc> erarclist) {
		this.addAttribute("ui.stylesheet", CSS_FILE);
		this.erknotlist = erknotlist;
		this.erarclist = erarclist;
		
		for (int i = 0; i < erknotlist.size(); i++) {
			
			if (this.getNode(this.erknotlist.get(i).getLabel()) == null) {			//Einfügen neuer Knoten in den ER-Graphen
				Node node = this.addNode(erknotlist.get(i).getLabel());				
				node.addAttribute("ui.label", erknotlist.get(i).getLabel());		
				node.addAttribute("ui.class", "ernode");							//normale Darstellung des Knotens											
			}
			
			if (this.erknotlist.get(i).getknot_mx() == 1 ) { //Darstellung des Knotens m
				this.getNode(this.erknotlist.get(i).getLabel()).removeAttribute("ui.class");
				this.getNode(this.erknotlist.get(i).getLabel()).addAttribute("ui.class", "ernodem1"); 
			}
			if (this.erknotlist.get(i).getknot_mx() == 2 ) {//Darstellung des Knotens m'
				this.getNode(this.erknotlist.get(i).getLabel()).removeAttribute("ui.class");
				this.getNode(this.erknotlist.get(i).getLabel()).addAttribute("ui.class", "ernodem2");
			}
		}
		
		
		for (int j = 0; j < this.erarclist.size(); j++) {				//Neue Kante dann einfügen, wenn noch keine Kante mit dieser
			String label = this.erarclist.get(j).getId();				//ID vorhanden ist oder, wenn ID zwar bereits vorhanden ist,
			String source = this.erarclist.get(j).getSource() ;			//aber andere Knoten miteiander verbindet.
			String target = this.erarclist.get(j).getTarget();
			String id = Integer.toString(j);
			if ((this.getEdge(id) != null) && ((this.getEdge(id).getSourceNode().hasAttribute(source) == false) && (this.getEdge(id).getTargetNode().hasAttribute(target) == false))){
			}
			else {
			   Edge edge = this.addEdge(id, source, target, true);
				edge.addAttribute("ui.label", label);	
			}
		}
		
		for (int k = 0; k < this.erarclist.size(); k++) {
			if (this.erarclist.get(k).isPartOfInfinityPath() == true) {
				System.out.println("F A R B - Test");
				this.getEdge(Integer.toString(k)).addAttribute("ui.class", "infinitypath");
			}
		}
		
		System.out.println("Kanten-Test");												//Test
		for (int j = 0; j < this.erarclist.size(); j++) {								//Test
			System.out.println("ID: " + this.erarclist.get(j).getId());					//Test
			System.out.println("Quelle: " + this.erarclist.get(j).getSource());			//Test
			System.out.println("Ziel: " + this.erarclist.get(j).getTarget());			//Test
		}																				//Test
		System.out.println("Ende Kanten-Test");											//Test
		
		
	}
	
	private boolean nodealreadyexist (ERKnot erknot) {
		boolean nodealreadyexist = false;
	//	for (ERKnot erknot this) {
			
//		}
		return nodealreadyexist;
	}
	
}
